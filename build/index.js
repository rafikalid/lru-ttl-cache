var t;module.exports=t=class{constructor(t){this._max=Infinity,this._ttl=Infinity,this._maxBytes=Infinity,this._refreshOnGet=!0,this._totalBytes=0,this._map=new Map,this._head=null,this._tail=null,this._tmeout=null,t&&this.setConfig(t)}setConfig(t){var e,i;if(t)try{if(i=t.max){if(!(Infinity===i||Number.isSafeInteger(i)&&i>0))throw"Options.max expected positive integer";this._max=i}if(i=t.ttl){if(!(Infinity===i||Number.isSafeInteger(i)&&i>0))throw"Options.ttl expected positive integer";this._ttl=i}if(i=t.maxBytes){if(!(Infinity===i||Number.isSafeInteger(i)&&i>0))throw"Options.maxBytes expected positive integer";this._maxBytes=i}if(Reflect.has(t,"refreshOnGet")){if("boolean"!=typeof t.refreshOnGet)throw"Options.refreshOnGet expect boolean";this._refreshOnGet=t.refreshOnGet}this._runTTL()}catch(t){throw"string"==typeof(e=t)&&(e=`LRU_TTL_CACHE>> ${e}`),e}return this}set(t,e,i=0){var s,h;if(s=this._map.get(t))s.value=e,s.bytes=i,this._refresh(s);else{for(s={value:e,key:t,bytes:i,prev:h=this._head,next:null,time:Date.now()},null!=h&&(h.next=s),this._head=s,this._map.set(t,s),this._totalBytes+=i,null==this._tail&&(this._tail=s),this._map.size>this._max&&this.pop();this._totalBytes>this._maxBytes;)this.pop();this._runTTL()}return this}get(t){var e;return(e=this._map.get(t))?(this._refreshOnGet&&this._refresh(e),e.value):void 0}pop(){var t,e;if(e=this._tail)return this._map.delete(e.key),(t=e.next)?(this._tail=t,t.prev=null):this._tail=this._head=null,this._totalBytes-=e.bytes,e.value}delete(t){var e,i,s;return(e=this._map.get(t))&&(this._map.delete(t),null!=(i=e.prev)&&(i.next=e.next),null!=(s=e.next)&&(s.prev=e.prev),this._totalBytes-=e.bytes),this}clear(){return this._map.clear(),this._head=this._tail=null,this._totalBytes=0,this}has(t){return this._map.has(t)}keys(){return this._map.keys()}entries(){return this._map.entries()}forEach(t){return this._map.forEach(t)}_refresh(t){var e,i,s;t.time=Date.now(),(e=this._head)!==t&&(null!=(i=t.prev)&&(i.next=t.next),null!=(s=t.next)&&(s.prev=t.prev),this._head=t,t.prev=e,t.next=null,e.next=t)}_runTTL(){var t,e;if(this._tmeout&&clearTimeout(this._tmeout),t=this._tail){for(e=Date.now()-this._ttl;t&&t.time<e;)this._map.delete(t.key),this._totalBytes-=t.bytes,t=t.next;t?(this._tail=t,t.prev=null,-Infinity!==e&&(this._tmeout=setTimeout(this._runTTL.bind(this),t.time-e))):this._tail=this._head=null}}},Object.defineProperties(t.prototype,{size:{get:function(){return this._map.size}}});